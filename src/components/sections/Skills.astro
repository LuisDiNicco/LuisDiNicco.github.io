---
// src/components/sections/Skills.astro
import { useTranslations } from '../../i18n';
import SectionTitle from '../ui/SectionTitle.astro';
import { SKILLS, SKILL_CATEGORIES } from '../../data/skills';
import { Icon } from 'astro-icon/components';

interface Props {
  lang: 'es' | 'en';
}

const { lang } = Astro.props;
const t = useTranslations(lang);
---

<section id="skills" class="scroll-mt-24 mb-32">
    
    <SectionTitle number="03" title={t('skills.title')} />

    <div class="bg-[#0a0a0a] border border-gray-800 rounded-xl p-6 shadow-xl mb-8 relative overflow-hidden group">
        <div class="absolute top-0 left-0 w-1 h-full bg-green-500/20 group-hover:bg-green-500/50 transition-colors"></div>
        <div class="flex flex-col md:flex-row md:items-center gap-4 text-sm font-mono relative z-10">
            <div class="flex items-center gap-2 text-green-500 font-bold">
                <span class="animate-pulse">➜</span>
                <span>$ filter --type=</span>
            </div>
            
            <div class="flex flex-wrap gap-2" id="skill-filters">
                {SKILL_CATEGORIES.map((cat) => (
                    <button 
                        data-filter={cat.id}
                        class={`px-3 py-1 rounded border border-transparent hover:bg-gray-800/50 transition-all cursor-pointer ${cat.id === 'all' ? 'text-green-400 bg-green-500/10 border-green-500/30' : 'text-gray-500 hover:text-gray-300'}`}
                    >
                        <span class={cat.color}>{t(cat.labelKey)}</span>
                    </button>
                ))}
            </div>
        </div>
    </div>

    <div class="grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 lg:grid-cols-5 gap-4 min-h-[200px]" id="skills-grid">
        {SKILLS.map((skill) => (
            skill.url ? (
                <a 
                    href={skill.url}
                    target="_blank"
                    rel="noopener noreferrer"
                    class="skill-card bg-[#111] border border-gray-800 p-4 rounded-lg hover:border-green-500/30 hover:bg-[#151515] transition-colors group flex flex-col items-center justify-center gap-3 h-[110px] md:h-[120px] no-underline text-inherit hover:text-inherit relative overflow-hidden"
                    data-category={skill.category}
                >
                    <div class="w-8 h-8 sm:w-10 sm:h-10 text-gray-500 group-hover:text-green-400 transition-colors duration-300 group-hover:-translate-y-2">
                        <Icon name={skill.icon} class="w-full h-full" />
                    </div>
                    
                    <span class="text-xs sm:text-sm font-mono text-gray-300 group-hover:text-white text-center break-words px-1 group-hover:-translate-y-2 transition-transform duration-300">
                        {skill.name}
                    </span>

                    <div class="absolute bottom-2 left-0 w-full text-center opacity-0 group-hover:opacity-100 transition-opacity duration-300">
                        <span class="text-[10px] font-mono text-green-500 bg-green-500/10 px-2 py-0.5 rounded border border-green-500/20">
                            {skill.level}
                        </span>
                    </div>
                </a>
            ) : (
                <div 
                    class="skill-card bg-[#111] border border-gray-800 p-4 rounded-lg hover:border-green-500/30 hover:bg-[#151515] transition-colors group flex flex-col items-center justify-center gap-3 h-[110px] md:h-[120px] relative overflow-hidden"
                    data-category={skill.category}
                >
                    <div class="w-8 h-8 sm:w-10 sm:h-10 text-gray-500 group-hover:text-green-400 transition-colors duration-300 group-hover:-translate-y-2">
                        <Icon name={skill.icon} class="w-full h-full" />
                    </div>
                    
                    <span class="text-xs sm:text-sm font-mono text-gray-300 group-hover:text-white text-center break-words px-1 group-hover:-translate-y-2 transition-transform duration-300">
                        {skill.name}
                    </span>

                    <div class="absolute bottom-2 left-0 w-full text-center opacity-0 group-hover:opacity-100 transition-opacity duration-300">
                        <span class="text-[10px] font-mono text-green-500 bg-green-500/10 px-2 py-0.5 rounded border border-green-500/20">
                            {skill.level}
                        </span>
                    </div>
                </div>
            )
        ))}
    </div>

</section>

<script>
    // 1. Importamos la librería
    import autoAnimate from '@formkit/auto-animate';

    const filters = document.querySelectorAll('#skill-filters button');
    const grid = document.getElementById('skills-grid');
    const cards = document.querySelectorAll('.skill-card');

    // 2. Inicializamos AutoAnimate en el contenedor padre (el grid)
    // Esto hace la magia: observa cambios en los hijos directos.
    if (grid) {
        autoAnimate(grid, {
            // Opcional: puedes ajustar la duración y el 'easing'
            duration: 300, 
            easing: 'ease-in-out'
        });
    }

    filters.forEach(btn => {
        btn.addEventListener('click', () => {
            // --- Lógica visual de los botones ---
            filters.forEach(b => {
                b.classList.remove('text-green-400', 'bg-green-500/10', 'border-green-500/30');
                b.classList.add('text-gray-500', 'border-transparent');
            });
            btn.classList.remove('text-gray-500', 'border-transparent');
            btn.classList.add('text-green-400', 'bg-green-500/10', 'border-green-500/30');

            const category = btn.getAttribute('data-filter');

            // --- Lógica de filtrado ---
            cards.forEach(card => {
                const cardCat = card.getAttribute('data-category');
                const htmlCard = card as HTMLElement;
                
                // Mantenemos la lógica simple de display 'flex' o 'none'.
                // AutoAnimate detectará este cambio y lo convertirá en una transición suave de opacidad y posición.
                if (category === 'all' || cardCat === category) {
                    htmlCard.style.display = 'flex'; 
                } else {
                    htmlCard.style.display = 'none';
                }
            });
        });
    });
</script>