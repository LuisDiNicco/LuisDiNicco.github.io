---
// src/components/sections/Skills.astro
import { useTranslations } from '../../i18n';
import SectionTitle from '../ui/SectionTitle.astro';
import { SKILLS, SKILL_CATEGORIES } from '../../data/skills';
import { Icon } from 'astro-icon/components';

interface Props {
  lang: 'es' | 'en';
}

const { lang } = Astro.props;
const t = useTranslations(lang);

const getLevelClasses = (level: string) => {
    switch (level) {
        case 'Básico':
            return 'text-gray-400 bg-gray-500/10 border-gray-500/30 shadow-none font-normal';
        case 'Intermedio':
            return 'text-green-500 bg-green-500/10 border-green-500/30 shadow-none font-medium';
        case 'Avanzado':
            return 'text-green-300 bg-green-500/20 border-green-500/50 shadow-[0_0_15px_rgba(34,197,94,0.4)] font-bold';
        default:
            return 'text-gray-400 bg-gray-500/10 border-gray-500/30';
    }
};
---

<section id="skills" class="scroll-mt-24 mb-32">
    
    <SectionTitle number="03" title={t('skills.title')} />

    <div class="bg-[#0a0a0a] border border-gray-800 rounded-xl p-6 shadow-xl mb-8 relative group">
        <div class="absolute top-0 left-0 w-1 h-full bg-green-500/20 group-hover:bg-green-500/50 transition-colors rounded-l-xl"></div>
        
        <!-- Help Icon Top Right -->
        <div class="absolute top-4 right-4 group/help z-20">
            <svg class="w-5 h-5 text-gray-600 hover:text-green-400 cursor-help transition-colors peer" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8.228 9c.549-1.165 2.03-2 3.772-2 2.21 0 4 1.343 4 3 0 1.4-1.278 2.575-3.006 2.907-.542.104-.994.54-.994 1.093m0 3h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path></svg>
            <div class="absolute right-0 bottom-full mb-2 w-64 p-3 bg-[#161616] text-xs text-gray-300 rounded-lg opacity-0 invisible peer-hover:opacity-100 peer-hover:visible transition-all font-mono shadow-2xl border border-gray-700 z-50">
                {lang === 'es' ? 'Filtra las habilidades por categoría haciendo clic en los botones.' : 'Filter skills by category by clicking the buttons.'}
            </div>
        </div>

        <div class="flex flex-col md:flex-row md:items-center gap-4 text-sm font-mono relative z-10 pr-8">
            <div class="flex items-center gap-2 text-green-500 font-bold whitespace-nowrap">
                <span class="animate-pulse">➜</span>
                <span>$ filter --type=</span>
            </div>
            
            <div class="flex flex-row overflow-x-auto gap-2 pb-2 md:pb-0 [&::-webkit-scrollbar]:hidden [-ms-overflow-style:none] [scrollbar-width:none]" id="skill-filters">
                {SKILL_CATEGORIES.map((cat) => (
                    <button 
                        data-filter={cat.id}
                        class={`whitespace-nowrap px-3 py-1 rounded border border-transparent hover:bg-gray-800/50 transition-all cursor-pointer ${cat.id === 'all' ? 'text-green-400 bg-green-500/10 border-green-500/30' : 'text-gray-500 hover:text-gray-300'}`}
                    >
                        <span class={cat.color}>{t(cat.labelKey)}</span>
                    </button>
                ))}
            </div>
        </div>
    </div>

    <div class="grid grid-cols-3 sm:grid-cols-4 md:grid-cols-5 lg:grid-cols-6 gap-3 min-h-[200px]" id="skills-grid">
        {SKILLS.map((skill) => (
            skill.url ? (
                <a 
                    href={skill.url}
                    target="_blank"
                    rel="noopener noreferrer"
                    class="skill-card bg-[#111] border border-gray-800 p-3 rounded-lg hover:border-green-500/30 hover:bg-[#151515] transition-colors group flex flex-col items-center justify-center gap-2 h-[90px] md:h-[100px] no-underline text-inherit hover:text-inherit relative overflow-hidden cursor-pointer"
                    data-category={skill.category}
                    data-skill-name={skill.name}
                >
                    <div class="w-6 h-6 sm:w-8 sm:h-8 text-gray-500 group-hover:text-green-400 transition-colors duration-300 group-hover:-translate-y-1.5">
                        <Icon name={skill.icon} class="w-full h-full" />
                    </div>
                    
                    <span class="text-[10px] sm:text-xs font-mono text-gray-300 group-hover:text-white text-center break-words px-1 group-hover:-translate-y-1.5 transition-transform duration-300">
                        {skill.name}
                    </span>

                    <div class="absolute bottom-1.5 left-0 w-full text-center opacity-0 group-hover:opacity-100 transition-opacity duration-300">
                        <span class={`text-[9px] font-mono px-1.5 py-0.5 rounded border ${getLevelClasses(skill.level)}`}>
                            {skill.level}
                        </span>
                    </div>
                </a>
            ) : (
                <div 
                    class="skill-card bg-[#111] border border-gray-800 p-3 rounded-lg hover:border-green-500/30 hover:bg-[#151515] transition-colors group flex flex-col items-center justify-center gap-2 h-[90px] md:h-[100px] relative overflow-hidden cursor-pointer"
                    data-category={skill.category}
                    data-skill-name={skill.name}
                >
                    <div class="w-6 h-6 sm:w-8 sm:h-8 text-gray-500 group-hover:text-green-400 transition-colors duration-300 group-hover:-translate-y-1.5">
                        <Icon name={skill.icon} class="w-full h-full" />
                    </div>
                    
                    <span class="text-[10px] sm:text-xs font-mono text-gray-300 group-hover:text-white text-center break-words px-1 group-hover:-translate-y-1.5 transition-transform duration-300">
                        {skill.name}
                    </span>

                    <div class="absolute bottom-1.5 left-0 w-full text-center opacity-0 group-hover:opacity-100 transition-opacity duration-300">
                        <span class={`text-[9px] font-mono px-1.5 py-0.5 rounded border ${getLevelClasses(skill.level)}`}>
                            {skill.level}
                        </span>
                    </div>
                </div>
            )
        ))}
    </div>

</section>

<script>
    // 1. Importamos la librería
    import autoAnimate from '@formkit/auto-animate';

    const filters = document.querySelectorAll('#skill-filters button');
    const grid = document.getElementById('skills-grid');
    const cards = document.querySelectorAll('.skill-card');

    // 2. Inicializamos AutoAnimate en el contenedor padre (el grid)
    // Esto hace la magia: observa cambios en los hijos directos.
    if (grid) {
        autoAnimate(grid, {
            // Opcional: puedes ajustar la duración y el 'easing'
            duration: 300, 
            easing: 'ease-in-out'
        });
    }

    filters.forEach(btn => {
        btn.addEventListener('click', () => {
            // --- Lógica visual de los botones ---
            filters.forEach(b => {
                b.classList.remove('text-green-400', 'bg-green-500/10', 'border-green-500/30');
                b.classList.add('text-gray-500', 'border-transparent');
            });
            btn.classList.remove('text-gray-500', 'border-transparent');
            btn.classList.add('text-green-400', 'bg-green-500/10', 'border-green-500/30');

            const category = btn.getAttribute('data-filter');

            // --- Lógica de filtrado ---
            cards.forEach(card => {
                const cardCat = card.getAttribute('data-category');
                const htmlCard = card as HTMLElement;
                
                // Mantenemos la lógica simple de display 'flex' o 'none'.
                // AutoAnimate detectará este cambio y lo convertirá en una transición suave de opacidad y posición.
                if (category === 'all' || cardCat === category) {
                    htmlCard.style.display = 'flex'; 
                } else {
                    htmlCard.style.display = 'none';
                }
            });
        });
    });
</script>